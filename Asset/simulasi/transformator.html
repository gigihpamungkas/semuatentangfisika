    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        .simulation-wrapper {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            font-family: 'Segoe UI', sans-serif;
            background-color: #ecf0f1;
            padding: 10px;
            box-sizing: border-box;
        }

        #ui-panel {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .slider-label {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 8px;
            color: #34495e;
        }

        #canvas-holder {
            width: 100%;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        input[type=range] { width: 100%; }
    </style>

<div class="simulation-wrapper">
    <div id="ui-panel">
        <h1 style="margin-top:0; font-size:1.4rem; color:#2c3e50; border-bottom:2px solid #3498db; padding-bottom:10px;">
            Eksperimen Transformator Pro
        </h1>
        <div class="control-grid">
            <div class="control-group">
                <div class="slider-label">Lilitan Primer (Np): <span id="np-val" style="color:#e67e22;">500</span></div>
                <div id="np-slider"></div>
            </div>
            <div class="control-group">
                <div class="slider-label">Lilitan Sekunder (Ns): <span id="ns-val" style="color:#3498db;">500</span></div>
                <div id="ns-slider"></div>
            </div>
            <div class="control-group">
                <div class="slider-label">Tegangan Sumber (Vp): <span id="vp-val" style="color:#27ae60;">10</span> V</div>
                <div id="vp-slider"></div>
            </div>
        </div>
    </div>
    <div id="canvas-holder"></div>
</div>

<script>
let npSlider, nsSlider, vpSlider;
let time = 0;
let centerX, coreWidth, coreHeight;

function setup() {
    let container = document.getElementById('canvas-holder');
    let cnv = createCanvas(container.offsetWidth, 450);
    cnv.parent('canvas-holder');

    npSlider = createSlider(100, 1000, 500, 100);
    npSlider.parent('np-slider');
    npSlider.style('width', '100%');

    nsSlider = createSlider(100, 1000, 500, 100);
    nsSlider.parent('ns-slider');
    nsSlider.style('width', '100%');

    vpSlider = createSlider(0, 20, 10, 1);
    vpSlider.parent('vp-slider');
    vpSlider.style('width', '100%');
    
    updateLayout();
}

function windowResized() {
    let container = document.getElementById('canvas-holder');
    resizeCanvas(container.offsetWidth, 450);
    updateLayout();
}

function updateLayout() {
    centerX = width / 2;
    coreWidth = min(width * 0.3, 200); // Inti besi mengecil di layar kecil
    coreHeight = 260;
}

function draw() {
    background(255);
    
    let Np = npSlider.value();
    let Ns = nsSlider.value();
    let Vp_rms = vpSlider.value();
    let Vs_rms = (Vp_rms * Ns / Np);

    document.getElementById('np-val').innerText = Np;
    document.getElementById('ns-val').innerText = Ns;
    document.getElementById('vp-val').innerText = Vp_rms;

    let AC = sin(time);

    // --- POSISI RELATIF ---
    let coreX = centerX - coreWidth/2;
    let meterOffset = width < 500 ? width * 0.4 : 250;

    // --- DRAWING CIRCUIT WIRES ---
    stroke(50); strokeWeight(3); noFill();
    // Primer (Kiri)
    line(centerX - meterOffset, 200, coreX, 200);
    line(centerX - meterOffset, 300, coreX, 300);
    // Sekunder (Kanan)
    line(coreX + coreWidth, 200, centerX + meterOffset, 200);
    line(coreX + coreWidth, 300, centerX + meterOffset, 300);

    // --- DRAW TRANSFORMER CORE ---
    fill(180); stroke(100); strokeWeight(2);
    rect(coreX, 120, coreWidth, coreHeight, 10); 
    fill(255); 
    let holeW = coreWidth * 0.6;
    rect(centerX - holeW/2, 160, holeW, 180, 5);  

    // --- DRAW FLUX ANIMATION ---
    drawFlux(centerX, AC, Vp_rms, coreWidth, holeW);

    // --- DRAW COILS ---
    drawCoil(coreX + 20, 160, Np/10, "PRIMER", coreWidth);
    drawCoil(coreX + coreWidth - 20, 160, Ns/10, "SEKUNDER", coreWidth);

    // --- DRAW VOLTMETERS ---
    drawMeter(centerX - meterOffset, 250, Vp_rms, "VOLTMETER Vp");
    drawMeter(centerX + meterOffset, 250, Vs_rms, "VOLTMETER Vs");

    time += 0.1;
}

function drawFlux(cx, factor, intensity, cw, hw) {
    push();
    let fluxAlpha = map(intensity, 0, 20, 0, 200);
    stroke(0, 100, 255, fluxAlpha * abs(factor));
    strokeWeight(map(intensity, 0, 20, 0, 6));
    noFill();
    // Fluks mengikuti ukuran core
    rectMode(CENTER);
    rect(cx, 250, (cw + hw)/2, 220, 10);
    pop();
}

function drawCoil(x, y, loops, label, cw) {
    push();
    stroke(184, 115, 51);
    strokeWeight(2.5);
    let coilW = min(cw * 0.25, 50);
    for(let i=0; i<loops; i++) {
        let yPos = y + (i * (180/loops));
        ellipse(x, yPos, coilW, 12);
    }
    fill(0); noStroke(); textSize(10); textAlign(CENTER);
    text(label, x, y - 20);
    pop();
}

function drawMeter(x, y, value, label) {
    push();
    translate(x, y);
    let s = width < 600 ? 0.7 : 1.0; 
    scale(s);
    
    fill(44, 62, 80); stroke(0); strokeWeight(2); rectMode(CENTER);
    rect(0, 0, 130, 90, 10);
    fill(20, 30, 20); rect(0, 10, 90, 35, 5);
    fill(100, 255, 100); noStroke(); textAlign(CENTER, CENTER);
    textSize(18); text(value.toFixed(1) + " V", 0, 10);
    fill(255); textSize(9); text(label, 0, -35);
    pop();
}
</script>