<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>

<style>
  body {
  margin: 0;
  padding: 20px;
  background-color: #ecf0f1;
  font-family: 'Segoe UI', sans-serif;
}

#app-container {
  max-width: 800px;
  margin: auto;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

#ui-panel {
  background: white;
  padding: 25px;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

h1 {
  margin-top: 0;
  font-size: 1.6rem;
  color: #2c3e50;
  border-bottom: 2px solid #3498db;
  padding-bottom: 10px;
}

.control-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 15px;
}

.slider-label {
  font-weight: 600;
  margin-bottom: 10px;
  color: #34495e;
}

canvas {
  display: block;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}
</style>

<div id="app-container">
    <div id="ui-panel">
      <h1>Eksperimen Transformator</h1>
      <div class="control-grid">
        <div class="control-group">
          <div class="slider-label">Jumlah Lilitan Primer (Np): <span id="np-val">500</span></div>
          <div id="np-slider"></div>
        </div>
        <div class="control-group">
          <div class="slider-label">Jumlah Lilitan Sekunder (Ns): <span id="ns-val">500</span></div>
          <div id="ns-slider"></div>
        </div>
        <div class="control-group">
          <div class="slider-label">Tegangan Sumber (Vp): <span id="vp-val">10</span> V</div>
          <div id="vp-slider"></div>
        </div>
      </div>
    </div>
    <div id="canvas-holder"></div>
  </div>

<script>
let npSlider, nsSlider, vpSlider;
let time = 0;

function setup() {
  let canvas = createCanvas(850, 480);
  canvas.parent('canvas-holder');

  npSlider = createSlider(100, 1000, 500, 100);
  npSlider.parent('np-slider');
  npSlider.style('width', '100%');

  nsSlider = createSlider(100, 1000, 500, 100);
  nsSlider.parent('ns-slider');
  nsSlider.style('width', '100%');

  vpSlider = createSlider(0, 20, 10, 1);
  vpSlider.parent('vp-slider');
  vpSlider.style('width', '100%');
}

function draw() {
  background(255);
  
  let Np = npSlider.value();
  let Ns = nsSlider.value();
  let Vp_rms = vpSlider.value();
  let Vs_rms = (Vp_rms * Ns / Np);

  // Update HTML Labels
  document.getElementById('np-val').innerText = Np;
  document.getElementById('ns-val').innerText = Ns;
  document.getElementById('vp-val').innerText = Vp_rms;

  let AC = sin(time);

  // --- DRAWING CIRCUIT WIRES ---
  stroke(50);
  strokeWeight(3);
  noFill();
  // Kabel Primer (Kiri)
  line(75, 200, 225, 200);
  line(75, 300, 225, 300);
  // Kabel Sekunder (Kanan)
  line(425, 200, 575, 200);
  line(425, 300, 575, 300);

  // --- DRAW TRANSFORMER CORE ---
  fill(180); stroke(100); strokeWeight(2);
  rect(325, 120, 200, 260, 10); // Core utama
  fill(255); 
  rect(365, 160, 120, 180, 5);  // Lubang tengah

  // --- DRAW FLUX ANIMATION ---
  drawFlux(AC, Vp_rms);

  // --- DRAW COILS ---
  drawCoil(345, 160, Np/10, AC * Vp_rms, "PRIMER");
  drawCoil(505, 160, Ns/10, AC * Vs_rms, "SEKUNDER");

  // --- DRAW VOLTMETERS ---
  drawMeter(75, 250, Vp_rms, "VOLTMETER Vp");
  drawMeter(575, 250, Vs_rms, "VOLTMETER Vs");

  time += 0.1;
}

function drawFlux(factor, intensity) {
  push();
  let fluxAlpha = map(intensity, 0, 20, 0, 200);
  stroke(0, 100, 255, fluxAlpha * abs(factor));
  strokeWeight(map(intensity, 0, 20, 0, 8));
  noFill();
  rect(345, 140, 160, 220, 10);
  pop();
}

function drawCoil(x, y, loops, instV, label) {
  push();
  stroke(184, 115, 51);
  strokeWeight(2.5);
  for(let i=0; i<loops; i++) {
    let yPos = y + (i * (180/loops));
    ellipse(x, yPos, 50, 12);
  }
  fill(0); noStroke(); textSize(12); textAlign(CENTER);
  text(label, x, y - 20);
  pop();
}

function drawMeter(x, y, value, label) {
  push();
  translate(x, y);
  
  // Outer Case
  fill(44, 62, 80); stroke(0); strokeWeight(2);
  rectMode(CENTER);
  rect(0, 0, 140, 100, 10);
  
  // Digital Screen
  fill(20, 30, 20);
  rect(0, 10, 100, 40, 5);
  
  // Value
  fill(100, 255, 100);
  noStroke();
  textAlign(CENTER, CENTER);
  textSize(22);
  text(value.toFixed(1) + " V", 0, 10);
  
  // Label
  fill(255);
  textSize(10);
  text(label, 0, -35);
  pop();
}
</script>